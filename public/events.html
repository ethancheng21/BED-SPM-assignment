<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Community Events</title>
  <style>
    /* Reset and base */
    * {
      margin: 0; padding: 0; box-sizing: border-box; scroll-behavior: smooth;
    }
    body {
      font-family: Arial, sans-serif;
      background-color: #fff;
      color: #111;
      line-height: 1.6;
      overflow-x: hidden;
      transition: background 0.3s, color 0.3s;
    }
    html, body {
      width: 100%; max-width: 100%;
    }

    /* Header */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      background-color: #fff;
      border-bottom: 1px solid #eee;
      min-height: 80px;
      width: 100%;
    }
    header * {
      line-height: 1;
    }
    .logo {
      font-size: 1.8rem;
      font-weight: bold;
      color: #005b96;
    }
    .nav-links {
      flex: 1;
      display: flex;
      justify-content: center;
      gap: 2rem;
    }
    /* Nav links default */
  .nav-links a {
    text-decoration: none;
    color: #333;              /* dark gray in light mode */
    font-weight: 500;
    font-size: 1.1rem;
    padding: 0.5rem 1rem;
    border-radius: 10px;
    transition: background 0.3s, color 0.3s;
  }
    /* Nav links hover light mode */
  .nav-links a:hover {
    background-color: #f4f4f4;
    color: #005b96;           /* blue */
  }
    .header-buttons {
      display: flex;
      gap: 0.75rem;
      align-items: center;
    }
    .action-btn {
      background-color: orange;
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      cursor: pointer;
      font-weight: bold;
      font-size: 1.1rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Title */
    h1 {
      text-align: center;
      margin: 2rem 0 3rem;
    }

    /* Event list container */
    #event-list {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 40px;
      margin: 0 auto 4rem;
      max-width: 1000px;
      padding: 0 20px;
    }

    /* Event card */
    .event-card {
      background-color: white;
      border: 1px solid #ccc;
      padding: 20px;
      width: 300px;
      box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
      border-radius: 10px;
      color: #111;
      transition: background 0.3s, color 0.3s;
    }
    .event-card h3 {
      margin-top: 0;
    }
    .event-card p {
      margin: 0.3rem 0;
    }

    /* Buttons */
    button {
      margin-top: 10px;
      margin-right: 10px;
      padding: 10px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      background-color: #4CAF50;
      color: white;
      font-weight: bold;
      transition: background 0.3s;
    }
    button:hover {
      background-color: #45a049;
    }
    .cancel-btn {
      background-color: #e74c3c;
    }
    .cancel-btn:hover {
      background-color: #c0392b;
    }

    /* Dark mode */
    body.dark-mode {
      background-color: #121212;
      color: #e0e0e0;
    }

    /* Dark mode nav links */
    body.dark-mode .nav-links a {
      color: white;             /* white text in dark mode */
    }

    body.dark-mode .nav-links a {
      color: white;
    }
    body.dark-mode .nav-links a:hover {
      background-color: transparent; /* no bg */
      color: orange;            /* highlight orange on hover */
    }
    body.dark-mode .event-card {
      background-color: #1e1e1e;
      color: #eee;
      border-color: #444;
      box-shadow: none;
    }
    body.dark-mode .action-btn {
      background-color: orange;
      color: white;
    }

    body.dark-mode header {
    background-color: #1e1e1e; /* dark header background */
    border-bottom-color: #444; /* subtle border */
    }


    /* Responsive */
    @media (max-width: 768px) {
      #event-list {
        flex-direction: column;
        max-width: 100%;
        gap: 20px;
      }
    }
  </style>
</head>
<body>

<div id="header-placeholder"></div>

<script>
  fetch('header.html')
    .then(response => response.text())
    .then(data => {
      document.getElementById('header-placeholder').innerHTML = data;
    });
</script>


<h1>Community Events</h1>

<div id="event-list"></div>

<script>
  const userId = localStorage.getItem("userId");
  const userName = localStorage.getItem("userName");

  if (!userId) {
    alert("Please login first.");
    window.location.href = "home.html";
  }

  const storedTheme = localStorage.getItem('theme') || 'light';
  document.documentElement.setAttribute('data-theme', storedTheme);

  function toggleDarkMode() {
    document.body.classList.toggle("dark-mode");
    if(document.body.classList.contains("dark-mode")){
      localStorage.setItem('theme', 'dark');
    } else {
      localStorage.setItem('theme', 'light');
    }
  }

  async function fetchEvents() {
    try {
      const res = await fetch("/api/events");
      if (!res.ok) throw new Error("Network response was not ok");
      const events = await res.json();

      const container = document.getElementById("event-list");
      container.innerHTML = "";

      events.forEach(event => {
        const card = document.createElement("div");
        card.className = "event-card";
        card.innerHTML = `
          <h3>${event.title}</h3>
          <p><strong>Date:</strong> ${new Date(event.date).toLocaleDateString()}</p>
          <p><strong>Time:</strong> ${formatTime(event.time)}</p>
          <p><strong>Location:</strong> ${event.location}</p>
          <p>${event.description}</p>
          <button onclick="rsvp(${event.event_id})">RSVP</button>
          <button onclick="cancelRsvp(${event.event_id})" class="cancel-btn">Cancel RSVP</button>
        `;
        container.appendChild(card);
      });
    } catch (error) {
      alert("Failed to load events.");
      console.error(error);
    }
  }

  function formatTime(rawTime) {
    if (!rawTime) return "N/A";
    const date = new Date(rawTime);
    return date.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit", hour12: true });
  }

  async function rsvp(eventId) {
    try {
      const res = await fetch(`/api/events/${eventId}/rsvp`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "userId": userId
        },
        body: JSON.stringify({ status: "going" })
      });
      const data = await res.json();
      alert(data.message || "RSVP successful");
    } catch {
      alert("Error RSVPing for event.");
    }
  }

  async function cancelRsvp(eventId) {
    try {
      const res = await fetch(`/api/events/${eventId}/unrsvp`, {
        method: "DELETE",
        headers: {
          "Content-Type": "application/json",
          "userId": userId
        }
      });
      const data = await res.json();
      alert(data.message || "RSVP cancelled");
    } catch {
      alert("Error cancelling RSVP.");
    }
  }

  function goToProfile() {
    window.location.href = "viewProfile.html";
  }

  window.onload = () => {
    if (storedTheme === 'dark') {
      document.body.classList.add('dark-mode');
    }
    fetchEvents();
  };
</script>


</body>
</html>
